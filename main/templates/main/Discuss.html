{% extends "global/Page.html" %}
{% load staticfiles otree_tags %}

{% block title %}
    Discuss Options
{% endblock %}

{% block content %}

    <div class="container-fluid">
      <div class="row" style="min-height:550px; margin-bottom: 10px; border-bottom: 1px solid gray; padding-bottom: 10px;">     
		   <div>
	        <div class="col-sm-3 col-lg-3" style=" min-width: 220px; max-width: 350px; top: 50px; margin-bottom: 50px;">
	        		<div id="playerLabel" style="height: 200px; border: 1px #ddd solid; border-radius: 4px">
	        			<h4 style="text-align: center;">Your User Profile:</h4>
	        			<img src={% static "avatar/"|add:avatar %} alt="Error: No Avatar Available" style="display: block; margin: auto; width:120px">
	        			<p style="text-align: center;"> Name: {{user_name}}, Threshold: {{player.node.threshold_text}} </p>
      	    	</div>
   	         <h4>Your Friends:</h4>
					<div id="playerList"></div>            
   	     </div>
      	  <div class="col-sm-9 col-lg-9">
      	  		<ul id="main-tabs" class="nav nav-tabs" role="tablist">
  						<li class="nav-item">
    						<a class="nav-link active" data-toggle="tab" href="#wall" role="tab">Wall</a>
  						</li>
  						<li class="nav-item">
    						<a class="nav-link" data-toggle="tab" href="#network" role="tab">Network</a>
  						</li>
					</ul>

					<!-- Tab panes -->
					<div class="tab-content"  style="position: relative; margin-top: 5px; min-height: 500px; padding: 10px; background-color: #f5f5f5">
					  <div class="tab-pane active" id="wall" role="tabpanel"></div>
  					  <div class="tab-pane" id="network" role="tabpanel" style="position: absolute; background-color: white; bottom:0px; top: 0px; left: 0px; right: 0px;">
						<div id="mynetwork" style="height: 100%; width: 100%;"></div>  					  
  					  </div>
					</div>
        	  </div>
        </div>
      </div>
      {% next_button %}
    </div>


{% endblock %}

{% block scripts %}
<script type="text/javascript">
var messageList = [];
{% for mId, mValue in messages.items %}
	messageList.push('{{mValue}}');
{% endfor %}

var playerId = {{player.id}};
var neighbors = {{neighbors}};
var thresholds = {{thresholds|safe}};
var userNames = {{user_names|safe}};
console.log(userNames);
var avatars = {{avatars|safe}};
var entries = JSON.parse('{{wall|safe}}');
var network_nodes = JSON.parse('{{nodes|safe}}');
var network_edges = JSON.parse('{{edges|safe}}');

</script>

<script type="text/javascript" src={% static "global/jquery-ui.min.js" %}></script>
<script type="text/javascript" src={% static "global/wall.js" %}></script>
<script type="text/javascript" src={% static "global/vis.min.js" %}></script>
<script type="text/javascript" src={% static "global/send_message.js" %}></script>
<script type="text/javascript" src={% static "global/player_list.js" %}></script>
<script type="text/javascript" src={% static "global/chat_channels.js" %}></script>

<script type="text/javascript" >
  var playerProfile = document.getElementById('playerLabel');
  playerProfile.onclick = function() {
    chat.setActiveChannel(playerId);
	wall.changeId(playerId);
	chat.infoChannel.send(JSON.stringify({
	  'type': 'list',
	  'content': {'playerId': playerId},				
	}));
  }

  // create an array with nodes
  var nodes = new vis.DataSet(network_nodes);

  // create an array with edges
  var edges = new vis.DataSet(network_edges);

  // create a network
  var container = document.getElementById('mynetwork');
  var data = {
    nodes: nodes,
    edges: edges
  };
  var options = {
  		interaction:{
    	dragNodes:false,
    	dragView: false,
    	hideEdgesOnDrag: false,
    	hideNodesOnDrag: false,
    	hover: false,
    	hoverConnectedEdges: true,
    	keyboard: {
      	enabled: false,
      	speed: {x: 10, y: 10, zoom: 0.02},
      	bindToWindow: true
    	},
    	multiselect: false,
    	navigationButtons: false,
    	selectable: true,
    	selectConnectedEdges: true,
    	tooltipDelay: 300,
    	zoomView: true
  		}
	}

  var network = new vis.Network(container, data, options);
  $('a[data-toggle="tab"][href="#network"]').on('shown.bs.tab', function (e) {
  	 network.fit();  		
  });
  window.onresize = function() {network.fit();}

</script>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href={% static "global/jquery-ui.min.css" %}>
<link rel="stylesheet" href={% static "global/wall.css" %}>
<link rel="stylesheet" href={% static "global/player_list.css" %}>
<link rel="stylesheet" href={% static "global/vis.min.css" %}>
{% endblock %}